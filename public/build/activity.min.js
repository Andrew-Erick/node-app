$(function(){function a(a,b){$.ajax({type:"DELETE",url:"/activity/delete",data:{ids:a},success:function(){b()}})}function b(){return{rowids:$.map(c.bootstrapTable("getSelections"),function(a){return a._id}),ids:$.map(c.bootstrapTable("getSelections"),function(a){return a._id})}}var c=$("#activityTable"),d=$("#activityRemove"),e=$("#activityToolbar"),f=$("#activityAdd"),g=$("#activityForm"),h=$("#activityModal");window.activityFormatter=function(a,b,c){return['<span class="edit" title="edit" data-toggle="modal" data-target=#'+h.attr("id")+">",'<i class="oi oi-pencil"></i></span>',"&nbsp;",'<span class="remove" title="remove">','<i class="oi oi-trash"></i></span>'].join("")},window.stageFormatter=function(a,b,c){return void 0==a?"":"<a target='_blanket' href='/preview/detail?id="+a._id+"'>"+a.name+"</a>"},window.typeFormatter=function(a,b,c){var d=["系统级","飞机级"];return null==a||""==a?"":d[a-1]},window.executorFormatter=function(a,b,c){var d=["市场研究","系统工程","市场和销售","总体气动","各系统工作包"];return null==a||""==a?"":d[a-1]},window.activityActionEvents={"click .edit":function(a,b,c,d){a.preventDefault(),g.attr({"data-add":"false","data-index":d}),g.find("[name]").each(function(a,b){var d=$(b).attr("name");"stage"==d?$(b).val(c[d]._id):$(b).val(c[d])})},"click .remove":function(b,d,e,f){b.preventDefault(),a([e._id],function(){c.bootstrapTable("remove",{field:"id",values:[e.id]})})}},c.on("check.bs.table uncheck.bs.table check-all.bs.table uncheck-all.bs.table",function(){d.prop("disabled",!c.bootstrapTable("getSelections").length)}),d.click(function(){var e=b();e.ids.length>0&&a(e.rowids,function(){c.bootstrapTable("remove",{field:"_id",values:e.ids}),d.prop("disabled",!0)})}),e.find("select").change(function(){c.bootstrapTable({exportDataType:$(this).val()})}),f.click(function(){g.attr("data-add",!0),g.removeAttr("data-index")}),h.on("hidden.bs.modal",function(){g.formValidation("resetForm",!0)}),g.formValidation({framework:"bootstrap",excluded:":disabled",icon:{valid:"glyphicon glyphicon-ok",invalid:"glyphicon glyphicon-remove",validating:"glyphicon glyphicon-refresh"},fields:{id:{validators:{notEmpty:{message:"the ID is required"},stringLength:{min:1,max:6,message:"The ID must be more than 1 and less than 6 characters long"},regexp:{regexp:/^[0-9]+$/,message:"The ID can only consist of number"}}},level:{},upper_activity:{},activity_number:{},activity:{},activity_description:{},type:{},input:{},output:{},task:{},executor:{},stage:{},tool:{},method:{}}}).on("success.form.fv",function(a){a.preventDefault();var b=$(a.target),d=b.serializeObject(),e=b.attr("data-add"),f=b.attr("data-index");""!=d._id&&null!=d._id||delete d._id,$.post("/activity/edit",d).done(function(a){null!=a&&("true"==e?c.bootstrapTable("insertRow",{index:1,row:a}):c.bootstrapTable("updateRow",{index:f,row:a}),h.modal("hide"),b.formValidation("resetForm",!0))})})});