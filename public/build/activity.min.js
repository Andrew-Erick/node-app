function deleteItem(a,b){$.ajax({type:"DELETE",url:"/activity/delete",data:{ids:a},success:function(){b()}})}function getIdSelections(){return{rowids:$.map($table.bootstrapTable("getSelections"),function(a){return a._id}),ids:$.map($table.bootstrapTable("getSelections"),function(a){return a._id})}}var $table=$("#activityTable"),$remove=$("#activityRemove"),$toolbar=$("#activityToolbar"),$add=$("#activityAdd"),$form=$("#activityForm"),$modal=$("#activityModal");window.activityFormatter=function(a,b,c){return['<span class="add" title="add" data-toggle="modal" data-target=#'+$modal.attr("id")+">",'<i class="oi oi-plus"></i></span>',"&nbsp;",'<span class="edit" title="edit" data-toggle="modal" data-target=#'+$modal.attr("id")+">",'<i class="oi oi-pencil"></i></span>',"&nbsp;",'<span class="remove" title="remove">','<i class="oi oi-trash"></i></span>'].join("")},window.stageFormatter=function(a,b,c){return void 0==a?"":"<a target='_blanket' href='/preview/detail?id="+a._id+"'>"+a.name+"</a>"},window.typeFormatter=function(a,b,c){var d=["飞机级","系统级","设备级"];return null==a||""==a?"":d[a-1]},window.executorFormatter=function(a,b,c){var d=["市场研究","系统工程","市场和销售","总体气动","各系统工作包"];return null==a||""==a?"":d[a-1]},window.activityActionEvents={"click .edit":function(a,b,c,d){a.preventDefault(),$form.attr({"data-add":"false","data-index":d}),console.log(c),$form.find("[name]").each(function(a,b){var d=$(b).attr("name");"stage"==d?$(b).val(void 0==c[d]?null:c[d]._id):$(b).val(c[d])})},"click .remove":function(a,b,c,d){a.preventDefault(),deleteItem([c._id],function(){$table.bootstrapTable("remove",{field:"id",values:[c.id]})})},"click .add":function(a,b,c,d){a.preventDefault(),$form.attr({"data-add":"true","data-index":d}),$form.find("input[name=pid]").val(c._id),$form.find("input[name=level]").val(parseInt(c.level)+1)}},$table.on("check.bs.table uncheck.bs.table check-all.bs.table uncheck-all.bs.table",function(){$remove.prop("disabled",!$table.bootstrapTable("getSelections").length)}),$remove.click(function(){var a=getIdSelections();a.ids.length>0&&deleteItem(a.rowids,function(){$table.bootstrapTable("remove",{field:"_id",values:a.ids}),$remove.prop("disabled",!0)})}),$toolbar.find("select").change(function(){$table.bootstrapTable({exportDataType:$(this).val()})}),$add.click(function(){$form.attr("data-add",!0),$form.removeAttr("data-index")}),$modal.on("hidden.bs.modal",function(){$form.formValidation("resetForm",!0)}),$table.bootstrapTable({url:"/activity/data",pagination:!0,treeView:!0,treeId:"_id",treeField:"activity",treeRootLevel:1,clickToSelect:!1}),$form.formValidation({framework:"bootstrap",excluded:":disabled",icon:{valid:"glyphicon glyphicon-ok",invalid:"glyphicon glyphicon-remove",validating:"glyphicon glyphicon-refresh"},fields:{id:{validators:{notEmpty:{message:"the ID is required"},stringLength:{min:1,max:6,message:"The ID must be more than 1 and less than 6 characters long"},regexp:{regexp:/^[0-9]+$/,message:"The ID can only consist of number"}}},_id:{},pid:{},level:{},activity_number:{},activity:{},description:{},type:{},input:{},output:{},task:{},executor:{},stage:{},tool:{},method:{}}}).on("success.form.fv",function(a){a.preventDefault();var b=$(a.target),c=b.serializeObject(),d=b.attr("data-add"),e=null==b.attr("data-index")?-1:b.attr("data-index");"true"==d&&e++;var f="true"==d?"insertRow":"updateRow";""!=c._id&&null!=c._id||delete c._id,""!=c.pid&&null!=c.pid||delete c.pid,$.post("/activity/edit",c).done(function(a){null!=a&&($table.bootstrapTable(f,{index:e,row:a}),$modal.modal("hide"),b.formValidation("resetForm",!0))})});